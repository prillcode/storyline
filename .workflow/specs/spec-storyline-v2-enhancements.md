---
spec_id: storyline-v2-enhancements
title: Storyline v2.0 - Setup Skill & Identifier System
status: ready_for_implementation
created: 2026-01-12
version: 2.0.0
---

# Technical Spec: Storyline v2.0 Enhancements

## Overview

**Goal:** Transform Storyline from a simple linear workflow tool into a production-ready system that supports multiple bodies of work (PRDs/initiatives) within a single project, with comprehensive setup/onboarding and flexible identifier tracking.

**Approach:**
1. Add `/sl-setup` skill for project initialization and guidance
2. Implement identifier system for tracking work items (JIRA tickets, feature codes, etc.)
3. Refactor all existing skills to support identifier-based organization
4. Introduce epic-based subdirectories for stories and specs
5. Add guided prompt creation when no PRD exists

## Motivation

**Current limitations:**
- No onboarding or setup guidance for new users
- Flat file structure doesn't scale for large projects
- No support for tracking multiple initiatives/bodies of work
- No integration with external tracking systems (JIRA, etc.)
- Assumes user always has a PRD document ready

**User needs:**
- Projects evolve over months/years with multiple PRDs
- Need to track work back to JIRA tickets or internal codes
- Want organized directory structure by epic
- Need guidance when starting without a formal PRD
- Want to understand where they are in the workflow

## High-Level Architecture

### New Directory Structure

```
project-root/
├── .workflow/
│   ├── PRD-mco-1234.md              # First initiative
│   ├── PRD-feature-789.md           # Later feature
│   ├── PRD-001.md                   # No identifier (fallback)
│   ├── epics/
│   │   ├── epic-mco-1234-01-auth.md
│   │   ├── epic-mco-1234-02-tasks.md
│   │   ├── epic-feature-789-01-export.md
│   │   └── epic-001-simple.md       # No identifier
│   ├── stories/
│   │   ├── epic-mco-1234-01/        # Stories grouped by epic
│   │   │   ├── story-01.md
│   │   │   ├── story-02.md
│   │   │   └── story-03.md
│   │   ├── epic-mco-1234-02/
│   │   │   └── story-01.md
│   │   └── epic-001/                # No identifier epic
│   │       └── story-01.md
│   ├── specs/
│   │   ├── epic-mco-1234-01/
│   │   │   ├── spec-01.md           # Simple story alone
│   │   │   ├── spec-stories-02-03-combined.md  # Multiple simple stories
│   │   │   └── spec-story01-01.md   # Complex story split (if story-01 complex)
│   │   └── epic-mco-1234-02/
│   │       └── spec-01.md
│   └── .planning/                    # Generated by create-plans (unchanged)
└── src/                              # Actual code
```

### Identifier System Design

**Identifier Properties:**
- **Format:** Alphanumeric + hyphens/underscores only
- **Case:** User-defined (preserved as entered)
- **Validation:** Regex: `^[a-zA-Z0-9_-]+$`
- **Examples:** `MCO-1234`, `feature-789`, `PROJ_ABC`, `v2-migration`

**Identifier Scope:**
- One identifier per PRD/body of work
- Multiple PRDs (with different identifiers) can exist in one project
- Identifier propagates: PRD → Epics → Stories → Specs
- No identifier is valid (falls back to numeric: `001`, `002`, etc.)

**Identifier Storage:**
- In filename: `PRD-[identifier].md`, `epic-[identifier]-[nn]-[slug].md`
- In frontmatter: `identifier: mco-1234` and `epic_id: mco-1234-01`
- Parsed from parent file when creating children

## Feature 1: `/sl-setup` Skill

### Command Structure

```bash
/sl-setup                # Interactive setup (default)
/sl-setup init           # Initialize .workflow/ structure only
/sl-setup status         # Show current project state
/sl-setup guide          # Display onboarding guide
/sl-setup check          # Verify installation
```

### Workflows

#### 1. `/sl-setup` (default - interactive)
**Purpose:** Comprehensive onboarding and project setup

**Steps:**
1. Check if `.workflow/` exists
   - If yes: Show status, offer to continue
   - If no: Create directory structure
2. Explain Storyline philosophy:
   - "A project has many bodies of work over its lifetime"
   - "Each PRD represents one epic-sized initiative"
   - "Identifiers help track work back to your planning system"
3. Display command overview with simple diagram
4. Ask: "What would you like to do?"
   - Initialize new project
   - View project status
   - See full guide
   - Exit

#### 2. `/sl-setup init`
**Purpose:** Create `.workflow/` directory structure

**Implementation:**
```javascript
Create directories:
  .workflow/
  .workflow/epics/
  .workflow/stories/
  .workflow/specs/
  .workflow/.planning/

Create .workflow/README.md with:
  - Explanation of directory purpose
  - Link to Storyline docs
  - Quick reference for commands
```

**Success criteria:**
- All directories created
- README.md written
- User informed of next steps

#### 3. `/sl-setup status`
**Purpose:** Show current project state and suggest next actions

**Implementation:**
```javascript
Scan .workflow/ and report:
  - Number of PRDs
  - Number of epics (by identifier)
  - Number of stories (by epic)
  - Number of specs (by epic)
  - Incomplete workflows (epics without stories, stories without specs)

Display as table:
  | PRD              | Epics | Stories | Specs | Status      |
  |------------------|-------|---------|-------|-------------|
  | PRD-mco-1234.md  | 2     | 5       | 4     | In progress |
  | PRD-feature.md   | 1     | 3       | 3     | Complete    |

Suggest next action:
  - "Run /sl-story-creator epic-mco-1234-02-*.md to create stories"
  - "Run /sl-spec-story stories/epic-mco-1234-01/story-03.md to create spec"
```

#### 4. `/sl-setup guide`
**Purpose:** Display comprehensive onboarding tutorial

**Content:**
```markdown
# Storyline Guide

## The Workflow
PRD → Epics → Stories → Specs → Implementation

## When to Use What

### Starting Fresh
1. /sl-setup init
2. /sl-epic-creator (will prompt for PRD content and identifier)
3. /sl-story-creator epic-XXX-01-*.md
4. /sl-spec-story stories/epic-XXX-01/story-01.md
5. /sl-develop specs/epic-XXX-01/spec-01.md

### Adding a New Feature
1. /sl-epic-creator (new PRD with new identifier)
2. Continue with story-creator, spec-story, develop...

### Understanding Your Progress
1. /sl-setup status

## Identifiers
- Optional but recommended (e.g., JIRA ticket: MCO-1234)
- Helps organize and track work
- Can be skipped (will use numbers: 001, 002, etc.)

## Directory Structure
[Show tree diagram]

## Tips
- One story can have multiple specs (if complex)
- Multiple stories can share one spec (if simple)
- Use identifiers to track back to project management tools
```

#### 5. `/sl-setup check`
**Purpose:** Verify Storyline installation

**Checks:**
- Storyline skills exist in `~/.claude/skills/`
- Commands exist in `~/.claude/commands/`
- Dependencies (create-plans, create-agent-skills) installed
- Display version info

**Output:**
```
✅ Storyline skills installed
✅ Commands available
✅ Dependencies present
✅ Version: 2.0.0

All systems ready!
```

### Skill Structure

```
skills/storyline-setup/
├── SKILL.md                     # Router with principles
├── workflows/
│   ├── interactive-setup.md     # Default flow
│   ├── init-project.md          # Directory creation
│   ├── show-status.md           # Project state analysis
│   ├── display-guide.md         # Tutorial content
│   └── verify-installation.md   # Health check
├── references/
│   ├── directory-structure.md   # Explanation of .workflow/
│   ├── workflow-patterns.md     # Common usage patterns
│   └── troubleshooting.md       # Common issues
└── templates/
    ├── workflow-readme.md       # Template for .workflow/README.md
    └── prd-template.md          # Template for guided PRD creation
```

## Feature 2: Identifier Support in `/sl-epic-creator`

### Enhanced Workflow

**Current:** User provides PRD file path
**New:** User provides PRD file path OR uses guided creation

#### Scenario A: User Has PRD File

```bash
/sl-epic-creator docs/requirements.md
```

**Flow:**
1. Read PRD file
2. Prompt: "Optional: Provide an identifier for this work (e.g., JIRA ticket MCO-1234):"
   - User enters: `MCO-1234`
   - Validate: alphanumeric + hyphens/underscores
   - Convert to consistent format: preserve case, use in filenames
3. Prompt: "How many epics should this be split into?"
   - Analyze PRD complexity
   - Suggest: "I recommend 3 epics based on the scope"
4. Generate epics:
   - With identifier: `epic-mco-1234-01-authentication.md`
   - Without: `epic-001-authentication.md`
5. Save identifier in epic frontmatter:
   ```yaml
   ---
   epic_id: mco-1234-01
   identifier: mco-1234
   epic_number: 01
   title: Authentication
   prd_source: docs/requirements.md
   ---
   ```

#### Scenario B: No PRD File (Guided Creation)

```bash
/sl-epic-creator
```

**Flow:**
1. Detect no file provided
2. Prompt: "No PRD file provided. Let's create one together!"
3. Prompt: "Optional: Provide an identifier (e.g., JIRA ticket MCO-1234) or press Enter to skip:"
4. Guided questions:
   - "What is the overall goal/theme of this body of work?"
   - "Who are the primary users/stakeholders?"
   - "What are the core features or capabilities needed?" (list)
   - "Are there any constraints or requirements?" (list)
   - "What is the success criteria?"
5. Generate PRD content from responses
6. Save as:
   - With identifier: `PRD-mco-1234.md`
   - Without: `PRD-001.md` (increment from existing)
7. Proceed to epic generation as in Scenario A

### Implementation Changes

**File:** `skills/storyline-epic-creator/SKILL.md`
- Update intake to handle no arguments (guided mode)
- Add identifier prompt logic
- Update routing to detect guided vs file mode

**New workflow:** `workflows/guided-prd-creation.md`
- Question prompts
- PRD template population
- Validation

**New reference:** `references/identifier-system.md`
- Identifier format rules
- Validation logic
- Propagation rules

**Update workflow:** `workflows/create-multi-epic.md`
- Add identifier detection
- Update filename generation
- Update frontmatter

**Update template:** `templates/epic.md`
- Add `identifier` and `epic_id` fields
- Update traceability section

## Feature 3: Identifier Support in `/sl-story-creator`

### Enhanced Workflow

**Input:** Epic file path (e.g., `epic-mco-1234-01-auth.md`)

**Flow:**
1. Read epic file
2. Parse identifier from:
   - Frontmatter: `identifier: mco-1234`, `epic_id: mco-1234-01`
   - Filename: `epic-mco-1234-01-auth.md` → extract `mco-1234-01`
3. Create epic-specific subdirectory:
   - `.workflow/stories/epic-mco-1234-01/`
4. Generate stories with simple numbering:
   - `story-01.md`
   - `story-02.md`
   - `story-03.md`
5. Add to frontmatter:
   ```yaml
   ---
   story_id: 01
   epic_id: mco-1234-01
   identifier: mco-1234
   parent_epic: ../epics/epic-mco-1234-01-auth.md
   ---
   ```

### Implementation Changes

**File:** `skills/storyline-story-creator/SKILL.md`
- Add identifier parsing logic in routing

**Update workflow:** `workflows/create-stories-from-epic.md`
- Parse identifier from epic
- Create epic subdirectory
- Update file paths
- Update frontmatter

**Update template:** `templates/story.md`
- Add identifier fields

## Feature 4: Identifier Support in `/sl-spec-story`

### Enhanced Workflow

**Input:** Story file path (e.g., `stories/epic-mco-1234-01/story-02.md`)

**Flow:**
1. Read story file
2. Parse identifier and epic from:
   - Frontmatter: `identifier: mco-1234`, `epic_id: mco-1234-01`
   - File path: `stories/epic-mco-1234-01/story-02.md` → extract `mco-1234-01`
3. Determine spec strategy (prompt user):
   - "This is story-02. Choose spec strategy:"
     - [ ] Simple story - create single spec (spec-02.md)
     - [ ] Complex story - will need multiple specs (spec-story02-01.md, spec-story02-02.md...)
     - [ ] Combine with other stories - combine into one spec (e.g., with story-03: spec-stories-02-03-combined.md)
4. Create spec in epic subdirectory:
   - `.workflow/specs/epic-mco-1234-01/spec-02.md`
5. Add to frontmatter:
   ```yaml
   ---
   spec_id: 02
   story_ids: [02]          # or [02, 03] if combined
   epic_id: mco-1234-01
   identifier: mco-1234
   parent_story: ../stories/epic-mco-1234-01/story-02.md
   complexity: simple       # or "split" or "combined"
   ---
   ```

### Spec Naming Conventions

**Simple (1 story → 1 spec):**
- `spec-01.md`
- `spec-02.md`

**Complex (1 story → multiple specs):**
- `spec-story02-01.md`
- `spec-story02-02.md`
- `spec-story02-03.md`

**Combined (multiple stories → 1 spec):**
- `spec-stories-02-03-combined.md`
- `spec-stories-04-05-06-combined.md`

### Implementation Changes

**File:** `skills/storyline-spec-story/SKILL.md`
- Add identifier parsing
- Add spec strategy prompt
- Update routing for epic subdirectories

**Update workflow:** `workflows/create-spec-from-story.md`
- Parse identifier from story
- Prompt for spec strategy
- Generate appropriate filename
- Create in epic subdirectory
- Update frontmatter with strategy

**Update template:** `templates/spec.md`
- Add identifier fields
- Add `story_ids` array
- Add `complexity` field
- Update next step to use new paths

## Feature 5: Identifier Support in `/sl-develop`

### Enhanced Workflow

**Input:** Spec file path (e.g., `specs/epic-mco-1234-01/spec-02.md`)

**Flow:**
1. Read spec file
2. Parse identifier from:
   - Frontmatter: `identifier: mco-1234`, `epic_id: mco-1234-01`
   - File path: `specs/epic-mco-1234-01/spec-02.md`
3. Convert to PLAN.md format (existing logic)
4. Execute via create-plans (existing logic)
5. Ensure SUMMARY.md includes traceability back to identifier

### Implementation Changes

**File:** `skills/storyline-develop/SKILL.md`
- Add identifier parsing for metadata
- Pass identifier through to create-plans context

**Update workflow:** `workflows/execute-spec.md`
- Parse identifier
- Include in PLAN.md metadata
- Ensure SUMMARY references full chain

## Traceability Chain

### Complete Chain with Identifiers

```
PRD-mco-1234.md
  └─ epic-mco-1234-01-auth.md
      └─ stories/epic-mco-1234-01/story-01.md
          └─ specs/epic-mco-1234-01/spec-01.md
              └─ .planning/mco-1234-01-spec-01/PLAN.md
                  └─ Code commits
                      └─ .planning/mco-1234-01-spec-01/SUMMARY.md
```

### Frontmatter Chain

**PRD:**
```yaml
---
prd_id: mco-1234
created: 2026-01-12
---
```

**Epic:**
```yaml
---
epic_id: mco-1234-01
identifier: mco-1234
prd_source: PRD-mco-1234.md
---
```

**Story:**
```yaml
---
story_id: 01
epic_id: mco-1234-01
identifier: mco-1234
parent_epic: ../../epics/epic-mco-1234-01-auth.md
---
```

**Spec:**
```yaml
---
spec_id: 01
story_ids: [01]
epic_id: mco-1234-01
identifier: mco-1234
parent_story: ../stories/epic-mco-1234-01/story-01.md
---
```

### Relative Path Updates

All templates need updated traceability sections:

**Epic → PRD:**
```markdown
**Source PRD:** ../PRD-mco-1234.md
```

**Story → Epic:**
```markdown
**Parent epic:** ../../epics/epic-mco-1234-01-auth.md
```

**Spec → Story & Epic:**
```markdown
**Parent story:** ../stories/epic-mco-1234-01/story-01.md
**Parent epic:** ../epics/epic-mco-1234-01-auth.md
```

## Testing Requirements

### Unit Testing (Manual Verification)

#### Test Case 1: Fresh Project with Identifier
1. Create new test directory
2. Run `/sl-setup init`
3. Verify directory structure created
4. Run `/sl-epic-creator` (guided mode)
5. Provide identifier: `TEST-123`
6. Answer guided questions
7. Verify:
   - PRD-test-123.md created
   - Epics named `epic-test-123-01-*.md`
   - Epic frontmatter contains identifier
8. Run `/sl-story-creator` on epic
9. Verify:
   - Stories directory: `stories/epic-test-123-01/`
   - Stories named `story-01.md`, `story-02.md`
   - Story frontmatter contains identifier chain
10. Run `/sl-spec-story` on story
11. Choose "simple" strategy
12. Verify:
    - Spec directory: `specs/epic-test-123-01/`
    - Spec named `spec-01.md`
    - Spec frontmatter contains identifier chain

#### Test Case 2: Fresh Project without Identifier
1. Create new test directory
2. Run `/sl-setup init`
3. Run `/sl-epic-creator` (guided mode)
4. Skip identifier (press Enter)
5. Verify:
   - PRD-001.md created
   - Epics named `epic-001-*.md`
   - No identifier in frontmatter
6. Run `/sl-story-creator` on epic
7. Verify:
   - Stories directory: `stories/epic-001/`
   - Stories work correctly
8. Continue through spec-story and develop

#### Test Case 3: Multiple PRDs in One Project
1. Create test directory
2. Run `/sl-setup init`
3. Create first PRD with identifier `PROJ-A`
4. Create epics, stories, specs
5. Create second PRD with identifier `PROJ-B`
6. Create epics, stories, specs
7. Run `/sl-setup status`
8. Verify:
   - Both PRDs listed
   - Separate epic groups
   - No collision in filenames
   - Status shows both initiatives

#### Test Case 4: Complex Spec Strategies
1. Create epic with identifier
2. Create 4 stories
3. For story-01: Choose "complex" → creates `spec-story01-01.md`, `spec-story01-02.md`
4. For story-02: Choose "simple" → creates `spec-02.md`
5. For story-03 + story-04: Choose "combine" → creates `spec-stories-03-04-combined.md`
6. Verify all specs in correct epic subdirectory
7. Verify frontmatter correctly references story IDs

#### Test Case 5: Backward Compatibility
1. Test with existing `.workflow/` from v1
2. Verify old files still work (no identifiers)
3. Run new commands on old structure
4. Verify graceful handling

### Integration Testing

1. Run full pipeline from `/sl-setup` → `/sl-develop`
2. Verify all files created correctly
3. Check traceability links work (manually click through)
4. Verify git commits reference correct identifiers

## Migration Strategy

### For Existing Projects (v1 → v2)

**No automatic migration needed.** New features are additive:

1. Old projects continue to work (backward compatible)
2. New identifiers only used when explicitly provided
3. Old flat structure (no epic subdirectories) still supported
4. Gradual adoption: users can start using identifiers for new work

### Deprecation Path

- v2.0: Introduce new features, keep old behavior as fallback
- v2.1+: Encourage identifier usage via prompts
- v3.0: Consider requiring identifiers (far future)

## Version & Release

### Version Number: 2.0.0

**Breaking changes:** None (additive only)
**New features:**
- `/sl-setup` command
- Identifier system
- Epic subdirectories
- Guided PRD creation
- Project status tracking

### package.json Update

```json
{
  "version": "2.0.0",
  "description": "Story-driven development workflow with multi-initiative support and flexible organization"
}
```

### Git Tag

```bash
git tag -a v2.0.0 -m "Version 2.0.0 - Setup skill, identifier system, epic subdirectories"
```

## Documentation Updates

### README.md Changes

1. Update pipeline diagram to show identifiers
2. Add section on `/sl-setup`
3. Explain identifier system
4. Show new directory structure
5. Add examples with identifiers
6. Update Quick Start guide

### New Documentation Files

1. `docs/IDENTIFIERS.md` - Full identifier system guide
2. `docs/DIRECTORY-STRUCTURE.md` - Detailed structure explanation
3. `docs/MIGRATION.md` - Guide for v1 users
4. Update `SETUP.md` with new setup command

## Implementation Order

### Phase 1: Setup Skill (Foundation)
1. Create `skills/storyline-setup/` structure
2. Implement `/sl-setup init` (directory creation)
3. Implement `/sl-setup check` (verification)
4. Implement `/sl-setup guide` (documentation)
5. Implement `/sl-setup status` (project analysis)
6. Create command `commands/sl-setup.md`

### Phase 2: Identifier System in Epic Creator
1. Add identifier prompt to epic-creator
2. Implement guided PRD creation workflow
3. Update epic naming with identifiers
4. Update epic frontmatter
5. Update epic templates

### Phase 3: Epic Subdirectories (Stories & Specs)
1. Update story-creator for epic subdirectories
2. Update story frontmatter with identifiers
3. Update spec-story for epic subdirectories
4. Add spec strategy prompts (simple/complex/combined)
5. Update spec frontmatter

### Phase 4: Develop & Traceability
1. Update develop skill for identifier parsing
2. Ensure SUMMARY includes identifier chain
3. Update all templates for traceability
4. Test full end-to-end flow

### Phase 5: Documentation & Examples
1. Update README.md
2. Create new documentation files
3. Update example workflow
4. Update install.sh output messages
5. Update uninstall.sh for new files

### Phase 6: Testing & Release
1. Manual testing of all test cases
2. Update version to 2.0.0
3. Create git tag
4. Update remote-install.sh
5. Write release notes

## Open Questions

None - all clarified with user.

## Success Criteria

- [ ] `/sl-setup` command works in all modes
- [ ] Identifiers propagate through entire chain
- [ ] Epic subdirectories created correctly
- [ ] All three spec strategies work (simple/complex/combined)
- [ ] Guided PRD creation works
- [ ] Status command accurately reports project state
- [ ] Backward compatibility maintained
- [ ] Documentation complete
- [ ] Version bumped to 2.0.0
- [ ] Installation script updated

## Risks & Mitigations

**Risk:** Breaking existing workflows
**Mitigation:** All changes are additive, old behavior preserved

**Risk:** Complex spec naming confusing users
**Mitigation:** Clear prompts, examples in templates, documentation

**Risk:** Identifier format conflicts
**Mitigation:** Clear validation rules, preserve user-defined case

**Risk:** Epic subdirectories make paths long
**Mitigation:** Use relative paths consistently, document structure

---

**Ready for implementation!**

This spec can be used as the reference document for implementing all v2.0 enhancements in a fresh context.
